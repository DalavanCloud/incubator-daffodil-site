<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Apache Daffodil (incubating) | Test Data Markup Language (TDML)</title>
    <meta name="description" content="Test Data Markup Language">
    <meta name="author" content="">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/assets/themes/apache/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="/assets/themes/apache/css/style.css?body=1" rel="stylesheet" type="text/css">
    <link href="/assets/themes/apache/css/syntax.css" rel="stylesheet"  type="text/css" media="screen" />

  </head>

  <body>

        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">
              <!--<img src="/assets/themes/apache/img/logo.png" width="50">-->
              Apache Daffodil (incubating)
          </a>
        </div>
        <nav class="navbar-collapse collapse" role="navigation">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="/releases">Releases</a></li>
            <li id="documentation">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Docs<b class="caret"></b></a>
              <ul class="dropdown-menu dropdown-left">
                <li><a href="/getting-started/">Getting Started</a></li>
                <li><a href="/examples/">Examples</a></li>
                <li><a href="/docs/latest/javadoc/">Java API</a></li>
                <li><a href="/docs/latest/scaladoc/">Scala API</a></li>
                <li><a href="/docs/dfdl/">DFDL Specification</a></li>
                <li><a href="/unsupported/">Unsupported Features</a></li>
                <li><a href="/faq/">Frequently Asked Questions</a></li>
              </ul>
            </li>
            <li id="community">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Community<b class="caret"></b></a>
              <ul class="dropdown-menu dropdown-left">
                <li><a href="/community">Get Involved</a></li>
                <li><a href="/people">People</a></li>
              </ul>
            </li>
            <li id="development">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Development<b class="caret"></b></a>
              <ul class="dropdown-menu dropdown-left">
                <li><a class="external" href="https://cwiki.apache.org/confluence/display/DAFFODIL/">Wiki</a></li>
                <li><a class="external" href="https://github.com/search?q=repo%3Aapache%2Fincubator-daffodil+repo%3Aapache%2Fincubator-daffodil-site&type=Repositories">GitHub</a></li>
                <li><a class="external" href="https://issues.apache.org/jira/projects/DAFFODIL/">JIRA</a></li>
              </ul>
            </li>
            <li id="apache">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Apache<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a class="external" href="http://www.apache.org/">Apache Software Foundation</a></li>
                <li><a class="external" href="http://www.apache.org/licenses/">License</a></li>
                <li><a class="external" href="http://www.apache.org/security">Security</a></li>
                <li><a class="external" href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                <li><a class="external" href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
              </ul>
            </li>
          </ul>
        </nav>
      </div>
    </div>




    <div class="container">
      <div class="row">
  <div class="col-md-12">
    <!--

-->

<h2 id="test-data-markup-language-tdml">Test Data Markup Language (TDML)</h2>

<p>Test Data Markup Language (TDML) it is a way of specifying a DFDL schema, input
test data, and expected result or expected error/diagnostic messages, all
self-contained in an XML file. IBM created TDML to capture tests for their own
DFDL implementation. Daffodil latched onto this and has since extended it a
bit, though there is an effort to reconcile TDML dialects so that all
implementations can run the same tests.</p>

<p>A TDML file is often useful just to ask a question about how something in DFDL
works, for example, to get a clarification. It allows for a level of precision
that is often lacking, but also often required when discussing complex data
format issues. As such, providing a TDML file along with a bug report is the
absolutely best way to demonstrate a problem.</p>

<p>By convention, a TDML file uses the file extension <code class="highlighter-rouge">.tdml</code>, or <code class="highlighter-rouge">.tdml.xml</code>
when used with the TDML “tutorial” feature.</p>

<p>The schema for a TDML file is available on <a href="https://github.com/apache/incubator-daffodil/blob/master/daffodil-lib/src/main/resources/org/apache/daffodil/xsd/tdml.xsd">GitHub</a>.</p>

<p>Below is an annotated TDML file for a very simple example:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="ASCII"?&gt;</span>
 
<span class="nt">&lt;tdml:testSuite</span>
  <span class="na">suiteName=</span><span class="s">"Bug Report TDML Template"</span>
  <span class="na">description=</span><span class="s">"Illustration of TDML for bug reporting."</span>
  <span class="na">xmlns:tdml=</span><span class="s">"http://www.ibm.com/xmlns/dfdl/testData"</span>
  <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="na">xmlns:xml=</span><span class="s">"http://www.w3.org/XML/1998/namespace"</span>
  <span class="na">xmlns:dfdl=</span><span class="s">"http://www.ogf.org/dfdl/dfdl-1.0/"</span>
  <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span>
  <span class="na">xmlns:ex=</span><span class="s">"http://example.com"</span>
  <span class="na">xmlns:gpf=</span><span class="s">"http://www.ibm.com/dfdl/GeneralPurposeFormat"</span>
  <span class="na">xmlns:daf=</span><span class="s">"urn:ogf:dfdl:2013:imp:daffodil.apache.org:2018:ext"</span>
  <span class="na">xmlns=</span><span class="s">"http://www.w3.org/1999/xhtml"</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.ibm.com/xmlns/dfdl/testData tdml.xsd"</span>
  <span class="na">defaultRoundTrip=</span><span class="s">"false"</span><span class="nt">&gt;</span>
   
  <span class="c">&lt;!--
    This example TDML file is for a self-contained bug report.
   
    It shows the definition of an inline schema and parse test and unparse test that use that schema.
  --&gt;</span>

  <span class="c">&lt;!-- 
    A DFDL schema is defined inside the tdml:defineSchema element. The contents
    are similar to a normal DFDL schema, allowing for imports, defining a
    global format via dfdl:defineFormat and dfdl:format, and defining schema
    xs:elements/groups/types/etc.
  --&gt;</span>

  <span class="nt">&lt;tdml:defineSchema</span> <span class="na">name=</span><span class="s">"bug01Schema"</span> <span class="na">elementFormDefault=</span><span class="s">"unqualified"</span><span class="nt">&gt;</span>
 
    <span class="nt">&lt;xs:import</span>
      <span class="na">namespace=</span><span class="s">"http://www.ibm.com/dfdl/GeneralPurposeFormat"</span>
      <span class="na">schemaLocation=</span><span class="s">"IBMdefined/GeneralPurposeFormat.xsd"</span> <span class="nt">/&gt;</span>
      
    <span class="nt">&lt;dfdl:defineFormat</span> <span class="na">name=</span><span class="s">"myFormat"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;dfdl:format</span> <span class="na">ref=</span><span class="s">"gpf:GeneralPurposeFormat"</span>
        <span class="na">lengthKind=</span><span class="s">"implicit"</span>
        <span class="na">representation=</span><span class="s">"text"</span>
        <span class="na">encoding=</span><span class="s">"ASCII"</span>
        <span class="na">initiator=</span><span class="s">""</span>
        <span class="na">terminator=</span><span class="s">""</span>
        <span class="na">separator=</span><span class="s">""</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/dfdl:defineFormat&gt;</span>
  
    <span class="nt">&lt;dfdl:format</span> <span class="na">ref=</span><span class="s">"ex:myFormat"</span> <span class="nt">/&gt;</span>
 
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"myTestRoot"</span> <span class="na">type=</span><span class="s">"xs:dateTime"</span>
      <span class="na">dfdl:calendarPattern=</span><span class="s">"MM.dd.yyyy 'at' HH:mm:ssZZZZZ"</span>
      <span class="na">dfdl:calendarPatternKind=</span><span class="s">"explicit"</span>
      <span class="na">dfdl:lengthKind=</span><span class="s">"delimited"</span>
      <span class="na">dfdl:terminator=</span><span class="s">"%NL;"</span> <span class="nt">/&gt;</span>
  
  <span class="nt">&lt;/tdml:defineSchema&gt;</span>
 
  <span class="c">&lt;!--
    Define a parse test case, using the above schema and root element. Input
    data is defined along with the expected infoset.
  --&gt;</span>

  <span class="nt">&lt;tdml:parserTestCase</span> <span class="na">name=</span><span class="s">"dateTimeTest"</span> <span class="na">root=</span><span class="s">"myTestRoot"</span> <span class="na">model=</span><span class="s">"bug01Schema"</span>
    <span class="na">description=</span><span class="s">"A hypothetical bug illustration about parsing a date time."</span><span class="nt">&gt;</span>
    
   <span class="nt">&lt;tdml:document&gt;</span>
     <span class="nt">&lt;tdml:documentPart</span> <span class="na">type=</span><span class="s">"text"</span>
       <span class="na">replaceDFDLEntities=</span><span class="s">"true"</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[04.02.2013 at 14:00:56 GMT-05:00%LF;]]&gt;</span><span class="nt">&lt;/tdml:documentPart&gt;</span>
   <span class="nt">&lt;/tdml:document&gt;</span>
 
   <span class="nt">&lt;tdml:infoset&gt;</span>
     <span class="nt">&lt;tdml:dfdlInfoset&gt;</span>
       <span class="nt">&lt;ex:myTestRoot&gt;</span>2013-04-02T14:00:56.000000-05:00<span class="nt">&lt;/ex:myTestRoot&gt;</span>
     <span class="nt">&lt;/tdml:dfdlInfoset&gt;</span>
   <span class="nt">&lt;/tdml:infoset&gt;</span>
      
  <span class="nt">&lt;/tdml:parserTestCase&gt;</span>

  <span class="c">&lt;!--
    Define an unparse test case, using the above schema and root element. An
    input infoset is defined along with the expected unparsed data.
  --&gt;</span>
 
  <span class="nt">&lt;tdml:unparserTestCase</span> <span class="na">name=</span><span class="s">"unparseDateTimeTest"</span> <span class="na">root=</span><span class="s">"myTestRoot"</span> <span class="na">model=</span><span class="s">"bug01Schema"</span>
    <span class="na">description=</span><span class="s">"Another bug illustration, this time unparsing direction."</span><span class="nt">&gt;</span>
 
    <span class="nt">&lt;tdml:infoset&gt;</span>
      <span class="nt">&lt;tdml:dfdlInfoset&gt;</span>
        <span class="nt">&lt;ex:myTestRoot&gt;</span>2013-04-02T14:00:56.000000-05:00<span class="nt">&lt;/ex:myTestRoot&gt;</span>
      <span class="nt">&lt;/tdml:dfdlInfoset&gt;</span>
    <span class="nt">&lt;/tdml:infoset&gt;</span>
 
    <span class="nt">&lt;tdml:document&gt;</span>
      <span class="nt">&lt;tdml:documentPart</span> <span class="na">type=</span><span class="s">"text"</span>
        <span class="na">replaceDFDLEntities=</span><span class="s">"true"</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[04.02.2013 at 14:00:56-05:00%CR;%LF;]]&gt;</span><span class="nt">&lt;/tdml:documentPart&gt;</span>
   <span class="nt">&lt;/tdml:document&gt;</span>
        
  <span class="nt">&lt;/tdml:unparserTestCase&gt;</span>
    
<span class="nt">&lt;/tdml:testSuite&gt;</span>
</code></pre>
</div>

<p>Suppose you save the above out as a file <code class="highlighter-rouge">myDateTimeBug.tdml</code>. You can then run
it using the <code class="highlighter-rouge">test</code> subcommand of the <a href="/cli">Daffodil Command Line Interface</a>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ daffodil test myDateTimeBug.tdml
</code></pre>
</div>

<h3 id="specifying-test-data">Specifying Test Data</h3>

<p>Test data can be specified in text, hexadecimal, individual bits, or in an
external file by setting the <code class="highlighter-rouge">type</code> attribute in the <code class="highlighter-rouge">tdml:documentPart</code>
element. Multiple <code class="highlighter-rouge">tdml:documentPart</code> elements are combined to create the
test data. The different documentPart types are illustrated below.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;tdml:document&gt;</span>
  <span class="c">&lt;!--
    A document part with type="text" is text. It is often a good idea to use
    CDATA to avoid whitespace changes made by some autoindenting IDE's.

    So in the example below, the line ending after '250;' and after '967;' are
    intentional parts of the data so as to illustrate that the whitespace is
    preserved.

    If you care exactly which kind of line ending is used, then you can use
    DFDL character entities to insert a %CR; %LF; or both. In this example,
    because the whitespace is expressed as whitespace, it depends on the
    platform where you edit this file whether the line ending is a LF (Unix
    convention), or a CRLF (MS Windows convention). By convention, it is
    usually recommended to use Unix style line-endings in TDML files and use
    character entities if explicit line endings are being tested.

    If you want to use DFDL character entities, you must turn on the
    replaceDFDLEntities="true" feature of the documentPart element.
  --&gt;</span>

  <span class="nt">&lt;tdml:documentPart</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[quantity:250;
hardnessRating:967;
]]&gt;</span><span class="nt">&lt;/tdml:documentPart&gt;</span>

  <span class="c">&lt;!--
    In 'text' both XML character entities, and DFDL's own character entities
    are interpreted.

    So here is a NUL terminated string that contains a date with some Japanese
    Kanji characters. The Japanese characters are expressed using XML numeric
    character entities. The NUL termination is expressed using a DFDL character
    entity.

    In this example one has no choice but to use a DFDL character entity. The
    NUL character (which has character code zero), is not allowed in XML
    documents, not even using an XML character entity. So you have to write
    '%NUL;' or '%#x00;' to express it using DFDL character entities.
  --&gt;</span>

  <span class="nt">&lt;tdml:documentPart</span> <span class="na">type=</span><span class="s">"text"</span>
    <span class="na">replaceDFDLEntities=</span><span class="s">"true"</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[1987&amp;#x5E74;10&amp;#x6708;&amp;#x65e5; BCE%NUL;]]&gt;</span><span class="nt">&lt;/tdml:documentPart&gt;</span>

  <span class="c">&lt;!--
    Type 'byte' means use hexadecimal to specify the data. Freeform whitespace
    is allowed and  any character that is not a-zA-Z0-9 is ignored. So you can
    use "." or "-" to separate groups of hex digits if you like.
  --&gt;</span>

  <span class="nt">&lt;tdml:documentPart</span> <span class="na">type=</span><span class="s">"byte"</span><span class="nt">&gt;</span>
    9Abf e4c3
    A5-E9-FF-00
  <span class="nt">&lt;/tdml:documentPart&gt;</span>

  <span class="c">&lt;!--
    Type 'bits' allows you to specify individual 0 and 1. Any character other
    than 0 or 1 is ignored.

    The number of bits does not have to be a multiple of 8. That is, whole
    bytes are not required.
  --&gt;</span>

  <span class="nt">&lt;tdml:documentPart</span> <span class="na">type=</span><span class="s">"bits"</span><span class="nt">&gt;</span>
    1.110 0.011 1   First 5 bit fields.
  <span class="nt">&lt;/tdml:documentPart&gt;</span>

  <span class="c">&lt;!--
    Type 'file' means the content is a file name where to get the data
  --&gt;</span>

  <span class="nt">&lt;tdml:documentPart</span> <span class="na">type=</span><span class="s">"file"</span><span class="nt">&gt;</span>/some/directory/testData.in.dat<span class="nt">&lt;/tdml:documentPart&gt;</span>

<span class="nt">&lt;/tdml:document&gt;</span>
</code></pre>
</div>
<p>Note that in order for a test to be considered successful, it must consume all
the data defined in the <code class="highlighter-rouge">tdml:document</code> element. Otherwise the test will fail
with a message about “left over data”.</p>

<h3 id="specifying-the-infoset">Specifying the Infoset</h3>

<p>The infoset can be provided either as an inline XML infoset or as a path to an
external file by setting the <code class="highlighter-rouge">type</code> attribute on the <code class="highlighter-rouge">tdml:dfdlInfoset</code>
element. If not provided, the type defaults to inline XML. For example:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;tdml:infoset&gt;</span>
  <span class="nt">&lt;tdml:dfdlInfoset</span> <span class="na">type=</span><span class="s">"infoset"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ex:myTestRoot&gt;</span>2013-04-02T14:00:56.000000-05:00<span class="nt">&lt;/ex:myTestRoot&gt;</span>
  <span class="nt">&lt;/tdml:dfdlInfoset&gt;</span>
<span class="nt">&lt;/tdml:infoset&gt;</span>

<span class="nt">&lt;tdml:infoset&gt;</span>
  <span class="nt">&lt;tdml:dfdlInfoset</span> <span class="na">type=</span><span class="s">"file"</span><span class="nt">&gt;</span>/some/directory/testData.in.xml<span class="nt">&lt;/tdml:dfdlInfoset&gt;</span>
<span class="nt">&lt;/tdml:infoset&gt;</span>
</code></pre>
</div>

<p>Note that the <code class="highlighter-rouge">tdml:dfdlInfoset</code> may need to contain characters that are not
legal in XML documents. Daffodil remaps these characters into legal XML
characters in the Unicode Private Use Areas (PUA). See <a href="/infoset#xml-illegal-characters">XML Illegal
Characters</a> for details.</p>

<h3 id="negative-tests-expecting-errorswarnings">Negative Tests: Expecting Errors/Warnings</h3>

<p>A poor or missing diagnostic message is a bug just as much as a broken feature.
TDML allows for creating negative tests to expect errors and warnings. To do
expect errors, replace the <code class="highlighter-rouge">tdml:infoset</code> element with a <code class="highlighter-rouge">tdml:errors</code>
element:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;tdml:errors&gt;</span>
  <span class="nt">&lt;tdml:error&gt;</span>Schema Definition Error<span class="nt">&lt;/tdml:error&gt;</span>
  <span class="nt">&lt;tdml:error&gt;</span>testElementName<span class="nt">&lt;/tdml:error&gt;</span>
<span class="nt">&lt;/tdml:errors&gt;</span>
</code></pre>
</div>

<p>Each <code class="highlighter-rouge">tdml:error</code> child element contains a sub-string which must be found
somewhere in the set of diagnostic messages that come out of the test. The
comparison is case-insensitive.</p>

<p>The <code class="highlighter-rouge">tdml:warnings</code> and <code class="highlighter-rouge">tdml:warning</code> elements behave just like the error
counterparts to define warnings that should be created during the test. Note
that warnings are considered non-fatal and so can appear alongside
<code class="highlighter-rouge">tdml:errors</code> and <code class="highlighter-rouge">tdml:infoset</code> elements.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;tdml:warnings&gt;</span>
  <span class="nt">&lt;tdml:warning&gt;</span>Schema Definition Warning<span class="nt">&lt;/tdml:warning&gt;</span>
  <span class="nt">&lt;tdml:warning&gt;</span>'http://www.ogf.org/dfdl/dfdl-1.0/' should be 'http://www.ogf.org/dfdl/'<span class="nt">&lt;/tdml:warning&gt;</span>
<span class="nt">&lt;/tdml:warnings&gt;</span>
</code></pre>
</div>

  </div>
</div>


      <footer>
        <footer class="site-footer">
    <div class="wrapper">
        <div class="footer-col-wrapper" style="font-size: .85em;">
            <hr>
            <div class="container">
                <div class="row">
                    <div class="col-xs-3" style="margin-top: 15px;">
                        <a href="http://incubator.apache.org"><img src="/assets/themes/apache/img/incubator_feather_egg_logo.png"
                                                                   alt="Apache Incubator" style="width:100%;"/></a>
                    </div>
                    <div class="col-xs-9">
                        Apache Daffodil is an effort undergoing <a href="https://incubator.apache.org/index.html">Incubation</a>
                        at The Apache Software Foundation (ASF), sponsored by the Incubator. Incubation is required of all newly
                        accepted projects until a further review indicates that the infrastructure, communications, and decision
                        making process have stabilized in a manner consistent with other successful ASF projects. While incubation
                        status is not necessarily a reflection of the completeness or stability of the code, it does indicate that
                        the project has yet to be fully endorsed by the ASF.
                    </div>
                </div>
            </div>
            <hr>
            <div>
                <div style="text-align: center;">
                    Copyright &copy; 2017 <a href="http://www.apache.org">The Apache Software Foundation</a>.
                    Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version
                    2.0</a>.
                    <br>
                    Apache, the Apache Feather logo, and the Apache Incubator project logo are trademarks of The Apache
                    Software Foundation.
                </div>
            </div>
        </div>
    </div>
</footer>

      </footer>
    </div>

    <script src="/assets/themes/apache/jquery/jquery-2.1.1.min.js"></script>

    <script src="/assets/themes/apache/bootstrap/js/bootstrap.min.js"></script>


  </body>
</html>

